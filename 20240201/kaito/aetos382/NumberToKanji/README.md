# NumberToKanji
C#お題 2024年2月度の挑戦です。提出者は[@aetos382](https://github.com/aetos382)です。

# 仕様
数値を漢数字表記にする関数です。入力値は`0`～`9,999,999,999,999,999`（9999兆9999億9999万9999）まで対応しています。

たとえば`123`を単に`一二三`とするのではなく、ちゃんと`百二十三`のように出力します。

`1,024`であれば`千二十四`となります。このように、百の位の値は`0`の場合は、百の位が丸ごと省略されます（ただし入力値が`0`の場合は`〇`と出力します）。

`10`、`100`、`1,000`はそれぞれ`十`、`百`、`千`となりますが、`10,000`は`万`ではなく`一万`、`10,000,000`は`一千万`など、自然な表記になるよう、出力を調整しています。

# 実装
プログラミング経験者であれば一度は「10進数から16進数への変換」をした（あるいはそのためのコードを書いた）ことがあるでしょう。16で割った余りを逆順に並べて行って……というやつです。

本コードはある意味で「10進数から十進数への変換」です。

ただし、素朴に実装すると、逆順に並べるためには`List<T>`を使ったりします。それでは、最近流行りのゼロ・アロケーション実装にはなりません。

また、単純に文字を並べて逆転させるだけだと、例えば`三十万`が`万十三`になるなどして、意味不明な結果になってしまいかねません。

後から逆転処理をしないためには、高い桁から計算してくる必要があります。では、最上位の桁が何の位なのかを求めるにはどうしたらよいでしょうか。

一度、入力値が`0`になるまで`10`で割ってみるという手はあります。ただし本実装では、高コストな乗除算の回数を最小限にするというコンセプトもありましたので、その手法は取っていません。

数学で「数の桁数を求める問題」を解くためによく使うのは[log(10)](https://ja.wikipedia.org/wiki/%E5%AF%BE%E6%95%B0)です。つまり、「10を何乗すれば目的の数になるのか」がわかれば、桁数が分かります。

ただし、.NETのBCLでは、そのための`Log10`メソッドは、何故か[Double](https://learn.microsoft.com/en-us/dotnet/api/system.math.log10?view=net-8.0)等の実数型にしか備わっておらず、整数型にはありません。

そこで本実装では、整数型にも備わっている`Log2`メソッドを使っています（ただし、それではストレートに桁数は求まらないので、補正を入れています）。

また、[BitOperations.Log2](https://learn.microsoft.com/en-us/dotnet/api/system.numerics.bitoperations.log2?view=net-8.0)や、タプルを返すバージョンの[Math.DivRem](https://learn.microsoft.com/en-us/dotnet/api/system.math.divrem?view=net-8.0)など、比較的新しいメソッドを取り入れています。

# 発展
[Generic math](https://learn.microsoft.com/en-us/dotnet/standard/generics/math)に対応させて一般化しようと思いましたが、あまり美しくならなかったので頓挫しています。
